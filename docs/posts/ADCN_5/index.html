<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Brad Stenger">
<meta name="dcterms.date" content="2025-11-19">

<title>ADCN: Health Algorithms &amp; Interfaces, Data Duty of Care, Injury Reports – newsletter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-a37c72dd2dbac68997fcdc15a3622e78.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-33562ca0c45c858621f5a0460d4134bc.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">newsletter</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">ADCN: Health Algorithms &amp; Interfaces, Data Duty of Care, Injury Reports</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Brad Stenger </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 19, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<div style="height:290">
    <iframe src="https://cdn.forms-content.sg-form.com/ed8875f7-7972-11f0-ad55-92cd5bc3b37f" width="340" height="300" scrolling="no"></iframe>
</div>

</div></div>
        
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>The ADCN newsletter archive can be found at <a href="https://newsletter.bradstenger.org" class="uri">https://newsletter.bradstenger.org</a>. I mention it here for two reasons. First, the site construction needs some attention and some work, and this public announcement will make it more likely to see those improvements occur sooner rather than later. Second, the website has a sign up where anyone can give their email to join ADCN’s mailing list. I’m still soft-launching ADCN but the public launch is coming. Getting the ADCN web presence up and running is a crucial step.</p>
<section id="algorithms-lcd-problem" class="level3">
<h3 class="anchored" data-anchor-id="algorithms-lcd-problem">Algorithms’ LCD Problem</h3>
<p>Personalization algorithms, in general, do not work so well when those algorithms have to serve thousands (or millions) of users. The situation is a classic case where usability has to function at a lowest common denominator across a population where the variation is substantial. For some people, especially people who trust machine instructions with little or no question, and in terms of demographics this population skews young, there is also an inabilitiy to contextualize recommendations that come from an AI source. Failing to understand AI in context makes human error likely despite confidence that is out of proportion with reality, mostly because reality gets ignored.</p>
<p>Every once in a while the scientific literature presents a window into health data, recommendation systems and its lowest common denominator. Apple <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0334950">recently published</a> in <em>PLOS One</em> results from the company’s sleep tracking study that took data from more than 35,000 Apple watch wearers who use the device as a sleep tracker. Most sleep data collection occurs in 1-14 day windows, predominantly at the low end, and it under-estimates the night to night sleep variability across populations. Apple simulated longer duration datasets and subsampled that data in an attempt to understand the depth of problem from short-duration sleep samples. Researchers stratified groups into one-hour intervals, and came to realize that the smaller group of lighter sleepers (6 +/- 1 hours) could not be differentiated from the more common 7 +/- 1 hour sleepers. “For the planning of future [sleep measurement] studies, there may be a resource and/or participant burden tension between sample size and duration of tracking,” the author conclude, saying “the path to mitigation lies in duration of tracking per participant, more so than boosting cohort sample size.”</p>
<p>Sleep is incredibly complex. <a href="https://x.com/SatchinPanda/status/1982819322868498688">Recent mouse studies</a> suggest close links between seasonal variation in diet and circadian rhythm. Circadian rhythm may need to be measured for long (probably very long) duration in order to understand seasonal, annual, reproductive, and human life stage variations in sleep, and in turn, recovery and performance. These are evolutionary forces at work where subtle and deep-seated adaptions have major meaningful implications, like the way <a href="https://en.wikipedia.org/wiki/Born_to_Run_(McDougall_book)">running adaptions</a> and <a href="https://en.wikipedia.org/wiki/Cooked:_A_Natural_History_of_Transformation">cooking adaptions</a> helped to shape human existence over long term time frames. Is socialized, high exertion, inter-personal competition, also known as sports, fundamentally human? I wouldn’t rule it out.</p>
<p>So what is AI good for when it comes to health and performance data? Arjun Mahajan and Stephen Gilbert gave their opinion in a <em>Nature Digital Medicine</em> <a href="https://www.nature.com/articles/s41746-025-02093-0">essay</a>, “Do we need AI guardians to protect us from health information overload?” Guardians are necessary, they write, because commercial health data devices send too many low-value alerts that miss what a health assistant should target, which are “filtering, contextualizing, and personalizing health information” for users. Threshold values in biometric data are a consistently useful interaction that the authors mention, and they do best when the data user specifies the target threshold (like heart rate during zone training). User-specified targets are personalized, contextualized, and filtered, all because a human sets all of those parameters when they go about creating the target alert on their device. Keeping a human in the feedback seems far more useful than a completely automated AI when it comes to data-backed health and performance information.</p>
<p>Sports have coaches. If path to personalization benefits from human input then there should be a place for coaches’ input on behalf of athletes, especially when it comes to determining useful athletes’ thresholds. Putting a coach (or coaches) in the feedback loop should help to avoid low-value alerts and to keep things personal, contextual and filtered. Problems will arise when misaligned incentives prompt coaches to not prioritize athletes’ best interests. In general athletes trust coaches. To give coaches the benefit of the doubt as a default setting should be appropriate, at least to start.</p>
<p>How things start might not be how things end up. There are signs that AI recommendation systems can and will be gamed by a servcice’s self-interests, and not in users’ best interests. <a href="https://www.schneier.com/blog/archives/2025/11/ai-summarization-optimization.html">A post</a> at Bruce Schneier’s blog describes the phenomena of AI Summary Optimization. The situation is analogous to Search Engine Optimization from 10-15 years ago. AISO is the new SEO. Keywords and content sequences, often jargon, factor into the subjective assessment made by an AI recommender system. Start down the path from automated threshold notification to subjective recommendations and from there it is a slippery slope to low-value alerts.</p>
</section>
<section id="duty-of-care-for-data" class="level3">
<h3 class="anchored" data-anchor-id="duty-of-care-for-data">Duty of Care for Data</h3>
<p>The FAIR consensus reports are <a href="https://bjsm.bmj.com/search/FAIR%252Bconsensus%20jcode%3Abjsports">a series of review papers</a> that examine “prevention strategies and modifiable risk factors” for female, woman and girl athletes. The papers have been appearing regularly in the <em>British Journal of Sports Medicine</em> and cover their review process and the targets for injury prevention such as concussion, upper extremities, lower extremities, etc. The series recently concluded with articles and essays that discuss dissemination and implementation of FAIR findings and recommendations. The challenge of translating medicine and transferring technology from research to practice is difficult and its easiest day, and any how-to guide will be hard to realize. Competence and its polar opposite, negligence, are difficult to identify during research translation, and without identifiable best and worst practices, the road map to a better place (or away from a worse place) is not available.</p>
<p>If there is one guiding principal for athletes’ health it is the idea of <a href="https://assets.publishing.service.gov.uk/media/5a81ff3c40f0b62305b91ed9/Duty_of_Care_Review_-_April_2017__2.pdf">duty of care</a>. Duty of care is a legal standard and a social norm and, in general, reflects an individual’s responsibility for the well-being of others. Duty of care means that coaches do not overwork players, that one player does not cheap shot another player, that equipment is safe, that medical staff are available, and any other measure to prevent forseeable harm. Duty of care is also a legal standard, and when breached can result in judgements of negligence and liability. Duty of care does not extend to athletes’ data and information, either in its legal or social context. But maybe it should. Duty of care already exists in the context of injury prevention. Greater awareness of its potential application to athletes’ data and information would incentivize action to translate research into practice.</p>
<p>Another recent BJSM review paper is <a href="https://blogs.bmj.com/bjsm/2025/11/03/can-the-menstrual-cycle-phase-impact-sports-performance/">an audit</a> of the effect female menstrual cycles have on sports injuries of all types and among all genders. (This was not a FAIR consensus review.) Injury analysis papers, the authors found, look primarily at evidence from male athletes and when they do consider female athletes’ evidence it does not account for hormonal fluctuations, despite the significant bearing that menstrual cycles have on injury occurrence. There’s a case to make that any aggregate injury analysis needs to account for cycles and their role. There’s also a case to make that cycles have enormous variation and it will take great effort to understand and account for the role of menstrual cycles in sports injury. Duty of care would suggest that there is an essential need to understand injury occurrences and prevention. If some analysis that takes shortcuts can help, those studies are valuable. But there is also an obligation to do the difficult, time-consuming work to understand the full scope of athlete injuries.</p>
<p>Concussions, among all athletes, have long been a duty of care quagmire. Consider how long it took for American football to recognize its problem with concussions. Looking the other way was far easier than solving the difficult problem of football concussions when solutions meant changing fundamentals of the game, but eventually duty of care was applied and change happened. Concussion diagnosis still does not have objective criteria and relies on athletes’ self-reporting (often reluctant). Canada’s Sport Information Resource Centre took <a href="https://sirc.ca/articles/sharing-responsibility-for-concussion-symptom-reporting-and-removal-from-play-in-youth-sport-it-takes-a-village/">the stance</a> that concussion symptoms reporting is a shared “duty of care” responsibility that cuts across all sports’ participants and at every level. Sports participation should not exist within a broader sports culture “that tolerates (and sometimes celebrates) pain and injury, and privileges performance over health,” the authors write. The authors are sport injury researchers at Canadian universities and they emphasize awareness and communication in their “it takes a village” solution.</p>
<p><a href="https://www.mhsaa.com/topics/coaches/staying-ahead-head-safety">A recent meeting</a> among Michigan high school sports administrators pointed to the considerable costs, inconsistent practices, and high stakes, the greatest of which are to athletes who are false-positives and pass their on-field cognitive evalutation. The need is for fast, accurate concussion exams in a Canada-like framework that prioritizes long-term health and well-being.</p>
<p>The legal dimension to duty of care makes it intimidating to cite duty of care in any context where there is risk of litigation. And personal injury law can be seen working at the periphery of sports to call out negligence and liability. The more important context is athletes’ health and well-being however, and duty of care should motivate the advances in sports management and coaching practice that research and technology make possible.</p>
</section>
<section id="injury-reports" class="level3">
<h3 class="anchored" data-anchor-id="injury-reports">Injury Reports</h3>
<p>Haralabob Voulgaris made tens of millions of dollars as a professional gambler on sports. Speaking with Pablo Torre on <a href="https://www.pablo.show/p/the-nbas-winningest-gambler-has-a">a podcast</a> Voulgaris said that the NBA had a real integrity problem when it came to the team injury reports, and the relationship between those reports and gambling. Voulgaris did not cite any specific example of improper or illegal activity but did describe how different teams approach the injury reports differently, with varying levels of effort and accuracy. Injury report information is crucial to serious sports gamblers who are anxious to know anything that could favor (or disfavor) their action.</p>
<p>The news about injury reports is not really about the NBA though. The NCAA <a href="https://sbcamericas.com/2025/10/31/ncaa-player-injury-report-march-madness/">now requires</a> player availability reports for the 2026 men’s and women’s Division 1 basketball tournaments. Public injury reports have been required for football in the SEC, Big Ten, ACC and Mid-American conferences. The SEC and ACC also require reports for men’s and women’s basketball, and for baseball. The NCAA pointed out that the reports keep gambling interests from interacting directly with student-athletes about their health status.</p>
<p>A medical school student and two professors wrote (an opinion essay)[https://www.statnews.com/2025/09/21/nfl-injury-list-sports-betting-athlete-medical-privacy/] in the medical news outlet <em>STAT</em>, saying that the personal information contained in team injury reports would constitute a serious privacy violation if they had not been subject to collective bargaining and contractual language between the athletes and their leagues. The origin of injury reports dates to 1947 when the NFL commission learned of dramatic shifts in betting leading up to a game where a flu had significantly compromised one team. The authors, two Yale doctors and a Case Western lawyer, say that it’s enough to say that an athlete will not compete, and any potentially invasive details are not necessary. As NCAA athletes become more subject to injury reporting requirements there is no indication who or how anyone will defend their privacy interests in the disclosures.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/newsletter\.bradstenger\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>